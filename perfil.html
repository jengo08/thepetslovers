<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mi perfil · The Pets Lovers</title>

  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --tpl-color: var(--color-principal, #339496);
      --tpl-text: var(--color-texto, #58425a);
      --tpl-muted:#666; --tpl-border:#ececec; --tpl-bg:#fff; --tpl-chip:#f6fbfb;
    }
    .tpl-page { padding-top: 110px; }
    .tpl-profile-wrap { max-width: 980px; margin: 0 auto; padding: 16px; }
    .tpl-page h1 { margin: 0 0 8px; }
    .tpl-page p.lead { color: var(--tpl-muted); margin: 0 0 18px; }

    .tpl-grid { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 840px){ .tpl-grid { grid-template-columns: 1fr 1fr; } }

    .tpl-card {
      background: var(--tpl-bg); border:1px solid var(--tpl-border);
      border-radius: 14px; padding: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .tpl-card h2 { margin: 0 0 6px; display:flex; align-items:center; gap:10px; }
    .tpl-pill {
      display:inline-flex; align-items:center; gap:6px;
      background: var(--tpl-chip); color: var(--tpl-text);
      border:1px solid var(--tpl-border); border-radius:999px;
      font-size:.85rem; padding:4px 10px;
    }
    .tpl-actions { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .tpl-btn {
      display:inline-flex; align-items:center; gap:8px; justify-content:center;
      border-radius:10px; padding:10px 14px; border:1px solid var(--tpl-border);
      text-decoration:none; font-weight:600; color:#fff; background: var(--tpl-color);
      transition: transform .06s ease, box-shadow .06s ease;
    }
    .tpl-btn.secondary { background:#fff; color:var(--tpl-text); }
    .tpl-btn:active { transform: translateY(1px); }

    .tpl-dl { display:grid; grid-template-columns: 150px 1fr; row-gap:4px; column-gap:10px; margin-top:8px; }
    .tpl-dl dt { color: var(--tpl-muted); }
    .tpl-dl dd { margin:0; color: var(--tpl-text); }

    .tpl-empty {
      border:1px dashed var(--tpl-border); border-radius:12px; padding:10px; color:var(--tpl-muted);
      display:flex; align-items:center; gap:8px; background:#fafafa;
    }

    .tpl-pet-list { display:flex; flex-direction:column; gap:10px; margin-top:8px; }
    .tpl-pet-item {
      display:flex; gap:10px; align-items:center; padding:8px; border:1px solid var(--tpl-border); border-radius:12px;
      background:#fff; position:relative;
    }
    .tpl-pet-thumb {
      width:56px; height:56px; flex:0 0 56px; border-radius:50%; object-fit:cover;
      border:2px solid var(--tpl-border); background:#fff;
    }
    .tpl-pet-icon {
      width:56px; height:56px; flex:0 0 56px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      border:2px solid var(--tpl-border); background:#fafafa; color:#9aa0a6; font-size:22px;
    }
    .tpl-pet-meta{ display:flex; flex-direction:column; line-height:1.25; }
    .tpl-pet-name{ font-weight:700; color:#222; }
    .tpl-pet-sub{ color:#666; font-size:.95rem; }
    .tpl-pet-edit{
      position:absolute; right:10px; bottom:8px; font-size:.9rem;
      color: var(--tpl-text); text-decoration: underline;
    }
    .tpl-pet-edit:focus{ outline:2px dashed var(--tpl-color); outline-offset:2px; border-radius:6px; }

    .tpl-logout{
      position: fixed !important;
      right: 16px;
      bottom: calc(16px + env(safe-area-inset-bottom, 0px));
      z-index: 999999;
      background: var(--tpl-color); color: #fff; border: 1px solid var(--tpl-border);
      border-radius: 999px; padding: 10px 12px; font-weight: 600; text-decoration: none;
      box-shadow: 0 4px 16px rgba(0,0,0,.12);
      pointer-events: auto;
    }
    .tpl-logout i{ margin-right:6px; }

    .sr-only{position:absolute!important;width:1px;height:1px;clip:rect(1px,1px,1px,1px);overflow:hidden;white-space:nowrap}
  </style>
</head>
<body>

  <!-- Navbar inyectada + fallback -->
  <div id="tpl-navbar">
    <noscript>
      <nav class="navbar">
        <div class="logo">
          <a href="index.html"><img src="images/logo.png.png" alt="The Pets Lovers"></a>
        </div>
        <a href="index.html" class="home-button">Inicio</a>
        <ul class="nav-links">
          <li><a href="como-funciona.html">Cómo funciona</a></li>
          <li><a href="servicios.html">Servicios</a></li>
          <li><a href="index.html#contactanos">Contáctanos</a></li>
          <li><a href="index.html#hazte-cuidador">Conviértete en cuidador</a></li>
        </ul>
        <a class="login-button" href="#iniciar-sesion">Iniciar sesión</a>
      </nav>
    </noscript>
  </div>

  <main class="container tpl-page">
    <div class="tpl-profile-wrap" aria-live="polite">
      <h1>Mi perfil</h1>
      <p class="lead">Completa tu información de propietario y la de tu(s) mascota(s). Así la reserva se rellena sola.</p>

      <section class="tpl-grid" id="tpl-profile-cards">
        <!-- Propietario -->
        <article class="tpl-card" id="tpl-card-owner">
          <h2><i class="fa-solid fa-user"></i> Propietario
            <span class="tpl-pill" id="tpl-owner-status"><i class="fa-solid fa-circle-exclamation"></i> Incompleto</span>
          </h2>
          <dl class="tpl-dl">
            <dt>Nombre</dt><dd id="tpl-owner-nombre">—</dd>
            <dt>Teléfono</dt><dd id="tpl-owner-telefono">—</dd>
            <dt>Zona</dt><dd id="tpl-owner-zona">—</dd>
            <dt>Email</dt><dd id="tpl-owner-email">—</dd>
          </dl>
          <div class="tpl-actions">
            <a class="tpl-btn" id="tpl-owner-fill" href="tpl-propietario.html"><i class="fa-solid fa-pen-to-square"></i> Rellenar</a>
            <a class="tpl-btn secondary" id="tpl-owner-edit" href="tpl-propietario.html" style="display:none"><i class="fa-solid fa-pen"></i> Editar</a>
          </div>
        </article>

        <!-- Mascotas -->
        <article class="tpl-card" id="tpl-card-pets">
          <h2><i class="fa-solid fa-paw"></i> Mascotas
            <span class="tpl-pill" id="tpl-pets-status"><i class="fa-solid fa-circle-exclamation"></i> Ninguna</span>
          </h2>

          <div class="tpl-empty" id="tpl-pets-empty">
            <i class="fa-regular fa-face-smile"></i>
            Aún no has añadido mascotas.
          </div>

          <div class="tpl-pet-list" id="tpl-pets-list" hidden></div>

          <div class="tpl-actions">
            <a class="tpl-btn" id="tpl-pet-add" href="tpl-mascota.html"><i class="fa-solid fa-plus"></i> Añadir mascota</a>
          </div>
        </article>

        <!-- Reservas -->
        <article class="tpl-card" id="tpl-card-bookings" style="grid-column: 1 / -1;">
          <h2><i class="fa-solid fa-calendar-check"></i> Reservas
            <span class="tpl-pill" id="tpl-bookings-status"><i class="fa-regular fa-circle"></i> Sin reservas</span>
          </h2>

          <div class="tpl-empty" id="tpl-bookings-empty">
            <i class="fa-regular fa-calendar"></i>
            Aquí verás tus reservas <em>enviadas / en revisión / aceptadas</em>.
          </div>

          <div id="tpl-bookings-list" hidden></div>

          <div class="tpl-actions">
            <a class="tpl-btn secondary" href="reserva.html"><i class="fa-solid fa-arrow-up-right-from-square"></i> Ir a reservar</a>
          </div>
        </article>
      </section>
    </div>
  </main>

  <!-- Botón Cerrar sesión -->
  <a
    href="index.html"
    id="tpl-logout"
    class="tpl-logout"
    onclick="return (window.__TPL_LOGOUT__ && window.__TPL_LOGOUT__());"
    aria-label="Cerrar sesión"
  ><i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión</a>

  <script>
    // Fallback logout
    window.__TPL_LOGOUT__ = function(){
      try{ sessionStorage.clear(); }catch(_){}
      try{
        localStorage.removeItem('tpl.session');
        localStorage.removeItem('tpl.auth');
        localStorage.removeItem('tpl.currentUser');
        localStorage.setItem('tpl.loggedOut', String(Date.now()));
        setTimeout(()=>localStorage.removeItem('tpl.loggedOut'), 0);
      }catch(_){}
      location.assign('index.html');
      return false;
    };
  </script>

  <!-- Footer inyectado + fallback -->
  <div id="tpl-footer">
    <noscript>
      <footer class="site-footer">
        <!-- … contenido del footer … -->
      </footer>
    </noscript>
  </div>

  <!-- Firebase (igual que en reserva.html) -->
  <script>
    window.__TPL_FIREBASE_CONFIG = {
      apiKey: "AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
      authDomain: "thepetslovers-c1111.firebaseapp.com",
      projectId: "thepetslovers-c1111",
      storageBucket: "thepetslovers-c1111.appspot.com",
      messagingSenderId: "415914577533",
      appId: "1:415914577533:web:0b7a056ebaa4f1de28ab14",
      measurementId: "G-FXPD69KXBG"
    };
  </script>

  <!-- Navbar/Footer -->
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>

  <!-- Perfil logic (una sola carga) -->
  <script src="tpl-perfil.js" defer></script>

  <script>document.querySelectorAll('.year-span')?.forEach(s=>s.textContent=new Date().getFullYear())</script>
</body>
</html>
