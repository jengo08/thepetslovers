<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Reserva · The Pets Lovers</title>

  <!-- Estilos globales del sitio -->
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    /* Ajustes suaves (respeta tu look&feel si ya tienes CSS propio) */
    .wrap{max-width:1100px;margin:auto;padding:24px}
    .hero{padding:18px 0 12px}
    .hero h1{margin:0}
    .hero .sub{color:#6b7280;margin:6px 0 0}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{border:1px solid #e5e7eb;border-radius:14px;padding:16px;background:#fff;margin-bottom:16px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:#111827;color:#fff}
    .btn-ghost{background:#fff;border:1px solid #e5e7eb}
    .muted{color:#6b7280}
    .disabled{opacity:.55;pointer-events:none}
    table.summary{width:100%;border-collapse:separate;border-spacing:0 6px}
    table.summary th,table.summary td{padding:8px 10px;border-bottom:1px dashed #e5e7eb}
    table.summary tr.total th,table.summary tr.total td{font-weight:700;border-bottom:none}
    #authWall{border:2px dashed #e5e7eb;background:#fffcee}
    .full{grid-column:1 / -1}
  </style>
</head>
<body>

  <!-- Navbar (si tienes loader global, lo rellenará) -->
  <header id="tpl-navbar"></header>

  <main class="wrap">

    <!-- Botón Atrás -->
    <button type="button" class="btn btn-ghost" id="btnBack" style="margin-bottom:12px">
      <i class="fa-solid fa-arrow-left"></i> Atrás
    </button>

    <section class="hero">
      <h1>Reserva tu servicio</h1>
      <p class="sub">Selecciona el servicio y la fecha para completar la reserva.</p>
    </section>

    <!-- Muro de autenticación -->
    <section id="authWall" class="card" style="display:none">
      <h3 style="margin:0 0 8px">Inicia sesión para reservar</h3>
      <p class="muted" style="margin:0 0 12px">Para continuar debes iniciar sesión o crear tu cuenta.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn btn-primary" href="/login.html"><i class="fa-solid fa-right-to-bracket"></i> Iniciar sesión</a>
        <a class="btn btn-ghost" href="/crear-cuenta.html"><i class="fa-solid fa-user-plus"></i> Crear cuenta</a>
      </div>
    </section>

    <!-- Formulario -->
    <form id="bookingForm" class="card disabled" data-tpl-redirect="/perfil.html" data-tpl-wait="800">

      <!-- Datos del servicio -->
      <section class="card" id="sec-servicio">
        <h3>Datos del servicio</h3>
        <div class="grid-2">
          <div>
            <label for="service">Servicio</label>
            <select id="service" name="service" required>
              <option value="">Selecciona…</option>
              <option value="guarderia">Guardería de día</option>
              <option value="alojamiento">Alojamiento nocturno</option>
              <option value="paseos">Paseo (60’)</option>
              <option value="visitas">Visita a domicilio (gato)</option>
              <option value="exoticos">Exóticos</option>
              <option value="transporte">Transporte</option>
            </select>
          </div>
          <div>
            <label for="startDate">Fecha inicio</label>
            <input id="startDate" name="startDate" type="date" required>
          </div>
          <div>
            <label for="endDate">Fecha fin</label>
            <input id="endDate" name="endDate" type="date" required>
          </div>
          <div>
            <label for="startTime">Hora inicio</label>
            <input id="startTime" name="Hora_inicio" type="time">
          </div>
          <div>
            <label for="endTime">Hora fin</label>
            <input id="endTime" name="Hora_fin" type="time">
          </div>
        </div>
      </section>

      <!-- Datos del titular -->
      <section class="card">
        <h3>Datos del titular</h3>
        <div class="grid-2">
          <div>
            <label for="firstName">Nombre y apellidos</label>
            <input id="firstName" name="firstName" required>
            <input id="lastName" name="lastName" style="display:none">
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required>
          </div>
          <div>
            <label for="phone">Teléfono</label>
            <input id="phone" name="phone" required>
          </div>
          <div>
            <label for="region">Comunidad Autónoma</label>
            <select id="region" name="region" required>
              <option value="">Selecciona…</option>
              <option>Andalucía</option><option>Aragón</option><option>Asturias</option><option>Baleares</option>
              <option>Canarias</option><option>Cantabria</option><option>Castilla-La Mancha</option><option>Castilla y León</option>
              <option>Cataluña</option><option>Comunidad Valenciana</option><option>Extremadura</option><option>Galicia</option>
              <option>La Rioja</option><option>Madrid</option><option>Murcia</option><option>Navarra</option>
              <option>País Vasco</option><option>Ceuta</option><option>Melilla</option>
            </select>
          </div>
          <div>
            <label for="address">Dirección</label>
            <input id="address" name="address" placeholder="Calle, nº, piso…">
          </div>
          <div>
            <label for="postalCode">Código Postal</label>
            <input id="postalCode" name="postalCode" placeholder="28001">
          </div>
          <div class="full">
            <label for="observations">Observaciones</label>
            <textarea id="observations" name="observations" placeholder="Llaves, timbre, alergias…"></textarea>
          </div>
        </div>
      </section>

      <!-- Mascotas -->
      <section class="card" id="petsAnchor">
        <h3>Mascotas</h3>

        <!-- Especie: visible si Visitas (gato) o Exóticos -->
        <div id="speciesBlock" style="display:none; margin-bottom:10px">
          <label for="species">Especie</label>
          <select id="species" name="species">
            <option value="gato">Gato</option>
            <option value="perro">Perro</option>
            <option value="conejo">Conejo</option>
            <option value="pajaro">Pájaro</option>
            <option value="huron">Hurón</option>
            <option value="iguana">Iguana</option>
            <option value="otro">Otro exótico</option>
          </select>
        </div>

        <!-- Marcador para UI de mascotas generada por JS -->
        <section id="tpl-pet-section" class="tpl-section" aria-label="Mascotas seleccionables"></section>
      </section>

      <!-- Desglose -->
      <section class="card">
        <h3>Desglose</h3>
        <table class="summary">
          <thead><tr><th>Concepto</th><th>Importe</th></tr></thead>
          <tbody id="summaryBody">
            <tr><th>Base suelto</th><td id="sumBase">0.00</td></tr>
            <tr><th>Visitas (principal)</th><td id="sumVisit1">0.00</td></tr>
            <tr><th>Visitas (medicación)</th><td id="sumVisit2">0.00</td></tr>
            <tr><th>Suplementos/bono</th><td id="sumFestivo">0.00</td></tr>
            <tr><th>Días</th><td id="sumSenalado">0</td></tr>
            <tr><th>Suplementos mascotas</th><td id="sumPets">0.00</td></tr>
            <tr class="total"><th>Subtotal</th><td id="sumSubtotal">0.00</td></tr>
            <tr class="total"><th>A pagar ahora</th><td id="sumDeposit">0.00</td></tr>
            <tr class="total"><th>Pendiente (12 días antes)</th><td id="sumResto">0.00</td></tr>
          </tbody>
        </table>
        <input type="hidden" id="summaryField" name="summaryField" value="">
        <p class="muted" style="margin-top:8px">
          Solo abonarás una pequeña parte ahora. El resto se pagará <strong>12 días antes</strong> del inicio del servicio.
        </p>
      </section>

      <!-- CTA -->
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-lock"></i> Reservar ahora</button>
      </div>
    </form>
  </main>

  <!-- Footer -->
  <footer id="tpl-footer"></footer>

  <!-- Firebase compat (si ya los cargas en tu layout, no los dupliques) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- (Opcional) Tu init de Firebase si esta página corre aislada -->
  <script>
    /* Si ya lo tienes en un include global, elimina este bloque.
    const firebaseConfig = { /* ... * / };
    firebase.initializeApp(firebaseConfig);
    */
  </script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // Config global con tus IDs (los mismos del proyecto)
    window.TPL_EMAILJS = {
      serviceId: "service_odjqrfl",
      publicKey: "L2xAATfVuHJwj4EIV",
      templates: {
        cliente: "template_rao5n0c",
        gestion: "template_rao5n0c"
      }
    };
    try{
      if(window.TPL_EMAILJS.publicKey){ emailjs.init(window.TPL_EMAILJS.publicKey); }
    }catch(e){ console.warn('EmailJS init error', e); }
  </script>

  <!-- Puente de sesión (JPJRJS) y motor de reservas -->
  <script src="/tpl-auth-bridge.js"></script>
  <script src="/tpl-reservas.js"></script>

</body>
</html>
