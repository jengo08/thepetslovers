<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reserva · The Pets Lovers</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    .booking-wrapper{ max-width: 980px; margin: 120px auto 60px; padding: 20px; background: #fff; border:1px solid #eee; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,.05);}
    .booking-header{ text-align:center; margin-bottom: 18px; }
    .booking-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; }
    .booking-field{ display:flex; flex-direction:column; gap:6px; }
    .booking-field label{ font-weight:700; font-size:.95rem; color: var(--color-texto); }
    .booking-field input, .booking-field select, .booking-field textarea{
      padding:10px 12px; border:1px solid #ddd; border-radius:8px; font-family:var(--fuente-texto);
    }
    .booking-actions{ display:flex; gap:12px; justify-content:center; margin-top: 16px; }
    .note{ font-size:.95rem; color:#666; text-align:center; margin: 10px 0 0; }
    .auth-wall{ padding:14px; border:1px dashed #bbb; border-radius:10px; text-align:center; background:#fafafa; margin-bottom:16px; }
    .auth-wall strong{ color: var(--color-texto); }
    .disabled{ opacity:.6; pointer-events:none; }

    /* TPL: INICIO BLOQUE NUEVO [Desglose de pago] */
    .summary-panel{ margin-top: 16px; background:#fafafa; border:1px solid #eee; border-radius:10px; padding:16px; }
    .summary-grid{ display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
    .summary-row{ display:contents; }
    .summary-label{ color:#555; }
    .summary-value{ font-weight:700; color: var(--color-texto); text-align:right; }
    .summary-muted{ color:#999; font-weight:400; }
    .summary-total{ border-top:1px solid #e7e7e7; margin-top:8px; padding-top:8px; font-size:1.05rem; }
    .summary-badge{ display:inline-block; font-size:.85rem; padding:2px 8px; border-radius:999px; border:1px dashed #bbb; color:#666; }
    /* TPL: FIN BLOQUE NUEVO */

    /* TPL: INICIO BLOQUE NUEVO [Pequeños detalles] */
    .readonly-chip{ background:#f2f8f8; border:1px dashed #cfe7e7; border-radius:8px; padding:10px 12px; font-size:.95rem; }
    .inline{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .help-tiny{ font-size:.85rem; color:#777; }
    /* TPL: FIN BLOQUE NUEVO */
  </style>
</head>
<body>

  <!-- Navbar unificada (inyectada) -->
  <div id="tpl-navbar">
    <noscript>
      <nav class="navbar">
        <div class="logo">
          <a href="index.html"><img src="images/logo.png.png" alt="The Pets Lovers"></a>
        </div>
        <a href="index.html" class="home-button">Inicio</a>
        <ul class="nav-links">
          <li><a href="como-funciona.html">Cómo funciona</a></li>
          <li><a href="servicios.html">Servicios</a></li>
          <li><a href="index.html#contactanos">Contáctanos</a></li>
          <li><a href="index.html#hazte-cuidador">Conviértete en cuidador</a></li>
        </ul>
        <a class="login-button" href="#iniciar-sesion">Iniciar sesión</a>
      </nav>
    </noscript>
  </div>

  <div class="booking-wrapper">
    <div class="booking-header">
      <h1>Reserva tu servicio</h1>
      <p>Selecciona el servicio y la fecha. Para completar la reserva es necesario iniciar sesión y tener los datos de tu mascota guardados.</p>
    </div>

    <!-- Muro de autenticación -->
    <div id="authWall" class="auth-wall">
      <p><strong>Para reservar debes estar registrada o iniciar sesión.</strong></p>
      <div class="booking-actions">
        <a href="login.html?next=reserva.html" class="cta-button" id="btnLogin">Iniciar sesión</a>
        <a href="registro.html?next=reserva.html" class="cta-button" id="btnRegister" style="background:#fff;color:var(--color-principal);border:2px solid var(--color-principal);">Registrarme</a>
      </div>
      <p class="note">Cuando actives tu cuenta, podrás completar la reserva desde aquí.</p>
    </div>

    <!-- TPL: INICIO BLOQUE NUEVO [Conexión Formspree – endpoint ya configurado] -->
    <form id="bookingForm" class="disabled" novalidate action="https://formspree.io/f/mdkdvlpr" method="POST">
    <!-- TPL: FIN BLOQUE NUEVO -->

      <div class="booking-grid">

        <!-- TPL: INICIO BLOQUE NUEVO [Servicios ampliados] -->
        <div class="booking-field">
          <label for="service">Servicio</label>
          <select id="service" name="Servicio" required>
            <option value="">Elige un servicio…</option>
            <option value="visitas">Visitas a domicilio (gatos)</option>
            <option value="paseos">Paseos</option>
            <option value="guarderia">Guardería de día</option>
            <option value="alojamiento">Alojamiento (por día)</option>
            <option value="bodas">Bodas y servicios exclusivos</option>
            <option value="exoticos">Mascotas exóticas</option>
            <option value="transporte">Transporte</option>
            <option value="posoperatorios">Cuidados posoperatorios</option>
          </select>
        </div>
        <!-- TPL: FIN BLOQUE NUEVO -->

        <!-- TPL: INICIO BLOQUE NUEVO [Duración solo para visitas] -->
        <div class="booking-field" id="fieldDuration" hidden>
          <label for="duration">Duración de la visita</label>
          <select id="duration" name="Duracion">
            <option value="60">60 minutos (19 € base)</option>
            <option value="90">90 minutos (32 € base)</option>
          </select>
          <span class="help-tiny">A partir del día 11: 60 min a 18 € / 90 min a 27 € por visita.</span>
        </div>
        <!-- TPL: FIN BLOQUE NUEVO -->

        <!-- TPL: INICIO BLOQUE NUEVO [Visitas al día (solo Visitas 60′)] -->
        <div class="booking-field" id="fieldVisitsPerDay" hidden>
          <label for="visitsPerDay">Visitas al día</label>
          <select id="visitsPerDay" name="Visitas_dia">
            <option value="1" selected>1 visita/día</option>
            <option value="2">2 visitas/día</option>
          </select>
          <span class="help-tiny">Para 60’. Si eliges 90’, será 1 visita/día.</span>
        </div>
        <!-- TPL: FIN BLOQUE NUEVO -->

        <!-- TPL: INICIO BLOQUE NUEVO [CCAA para autonómicos] -->
        <div class="booking-field">
          <label for="region">Comunidad Autónoma</label>
          <select id="region" name="CCAA">
            <option value="madrid" selected>Comunidad de Madrid</option>
            <option value="andalucia">Andalucía</option>
            <option value="aragon">Aragón</option>
            <option value="asturias">Asturias</option>
            <option value="baleares">Illes Balears</option>
            <option value="canarias">Canarias</option>
            <option value="cantabria">Cantabria</option>
            <option value="castilla-la-mancha">Castilla-La Mancha</option>
            <option value="castilla-y-leon">Castilla y León</option>
            <option value="cataluna">Cataluña</option>
            <option value="valenciana">Comunitat Valenciana</option>
            <option value="extremadura">Extremadura</option>
            <option value="galicia">Galicia</option>
            <option value="la-rioja">La Rioja</option>
            <option value="melilla">Melilla</option>
            <option value="murcia">Región de Murcia</option>
            <option value="navarra">Navarra</option>
            <option value="euskadi">País Vasco</option>
            <option value="ceuta">Ceuta</option>
            <option value="nacional">Solo festivos nacionales</option>
          </select>
        </div>
        <!-- TPL: FIN BLOQUE NUEVO -->

        <!-- TPL: INICIO BLOQUE NUEVO [Fechas inicio/fin] -->
        <div class="booking-field">
          <label for="date">Fecha de inicio</label>
          <input type="date" id="date" name="Fecha_inicio" required>
        </div>
        <div class="booking-field">
          <label for="dateEnd">Fecha de fin</label>
          <input type="date" id="dateEnd" name="Fecha_fin">
        </div>
        <!-- TPL: FIN BLOQUE NUEVO -->

        <div class="booking-field">
          <label for="start">Hora de entrada</label>
          <input type="time" id="start" name="Hora_inicio" required>
        </div>

        <div class="booking-field">
          <label for="end">Hora de salida</label>
          <input type="time" id="end" name="Hora_fin" required>
        </div>

        <div class="booking-field">
          <label for="location">Lugar</label>
          <input type="text" id="location" name="Lugar" placeholder="Dirección o zona">
        </div>

        <!-- TPL: INICIO BLOQUE NUEVO [Tipo animal, nº mascotas y cachorro] -->
        <div class="booking-field" id="fieldSpecies" hidden>
          <label for="species">Tipo de animal</label>
          <select id="species" name="Tipo_animal">
            <option value="perro">Perro</option>
            <option value="gato">Gato</option>
            <option value="exotico">Exótico</option>
            <option value="otros">Otros</option>
          </select>
        </div>

        <div class="booking-field" id="fieldIsPuppy" hidden>
          <label for="isPuppy">¿Es cachorro (≤ 6 meses)?</label>
          <select id="isPuppy" name="Cachorro">
            <option value="no">No</option>
            <option value="si">Sí</option>
            <option value="no_aplica">No aplica</option>
          </select>
        </div>

        <div class="booking-field" id="fieldNumPets" hidden>
          <label for="numPets">Nº de mascotas</label>
          <select id="numPets" name="N_mascotas">
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
            <option value="5">5</option>
            <option value="6+">6+</option>
          </select>
          <input id="numPetsExact" name="N_mascotas_exactas" type="number" min="6" step="1" placeholder="¿Cuántas en total?" style="margin-top
