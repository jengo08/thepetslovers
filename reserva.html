<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reserva · The Pets Lovers</title>

  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- TPL: INICIO BLOQUE NUEVO [Estilos mínimos de apoyo (no cambian tu look&feel)] -->
  <style>
    :root{ --color-principal:#339496; --color-texto:#58425a; }
    .tpl-hide{display:none!important}
    .booking-wrapper{ max-width: 980px; margin: 120px auto 60px; padding: 20px; background: #fff; border:1px solid #eee; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,.05);}
    .booking-header{ text-align:center; margin-bottom: 18px; }
    .booking-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; }
    .booking-field{ display:flex; flex-direction:column; gap:6px; }
    .booking-field label{ font-weight:700; font-size:.95rem; color: var(--color-texto); }
    .booking-field input, .booking-field select, .booking-field textarea{ padding:10px 12px; border:1px solid #ddd; border-radius:8px; font:inherit; }
    .booking-actions{ display:flex; gap:12px; justify-content:center; margin-top: 16px; flex-wrap: wrap; }
    .tpl-auth-wall{ padding:14px; border:1px dashed #bbb; border-radius:10px; text-align:center; background:#fafafa; margin: 16px 0; }
    .tpl-login-card{border:1px solid #eee;border-radius:12px;padding:16px;background:#fff;max-width:520px;margin:14px auto 0;box-shadow:0 2px 12px rgba(0,0,0,.05)}
    .tpl-login-title{margin:0 0 8px;color:#58425a;font-weight:700;font-size:1.05rem;text-align:center}
    .tpl-socials{display:grid;gap:10px;margin-bottom:8px}
    .tpl-btn-social{display:flex;align-items:center;justify-content:center;gap:8px;border:1px solid #ddd;border-radius:999px;padding:10px 14px;background:#fff;cursor:pointer;font-weight:600;color:var(--color-principal)}
    .tpl-btn{background:var(--color-principal);color:#fff;border:none;border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:600}
    .tpl-btn-outline{background:#fff;color:var(--color-principal);border:1px solid var(--color-principal);border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:600}
    .tpl-login-msg{min-height:1.2em;text-align:center;color:#58425a;margin-top:6px}
    .tpl-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:9999; }
    .tpl-overlay.on{ display:flex; }
    .tpl-modal{ background:#fff; padding:20px; border-radius:12px; max-width:520px; box-shadow:0 8px 30px rgba(0,0,0,.2); text-align:center; }
    .tpl-modal p{ margin:0 0 12px; }
  </style>
  <!-- TPL: FIN BLOQUE NUEVO -->
</head>
<body>

  <!-- Navbar (inyectada por tu tpl-navbar.js) -->
  <div id="tpl-navbar"><noscript><!-- fallback ligero --></noscript></div>

  <div class="booking-wrapper">
    <div class="booking-header">
      <h1>Reserva tu servicio</h1>
      <p>Para reservar debes iniciar sesión. Si ya tienes tu perfil y mascotas guardadas, los datos se rellenarán automáticamente.</p>
    </div>

    <!-- Muro de autenticación -->
    <div id="tpl-auth-wall" class="tpl-auth-wall">
      <p><strong>Para reservar debes estar registrada o iniciar sesión.</strong></p>
      <div id="tpl-inline-login"></div>
    </div>

    <!-- Formulario de reserva -->
    <form id="bookingForm"
          class="tpl-hide"
          data-tpl-type="reserva"
          data-tpl-success="Tu reserva se ha enviado. Podrás ver su estado en tu panel."
          data-tpl-redirect="perfil.html">

      <!-- Servicio y fechas -->
      <section class="tpl-section" aria-labelledby="sec-servicio">
        <h2 id="sec-servicio" class="tpl-hide">Servicio</h2>
        <div class="booking-grid">
          <div class="booking-field">
            <label for="service">Servicio</label>
            <select id="service" name="Servicio" required>
              <option value="">Elige un servicio…</option>
              <option value="visitas">Visitas a domicilio (gatos)</option>
              <option value="paseos">Paseos</option>
              <option value="guarderia">Guardería de día</option>
              <option value="alojamiento">Alojamiento (por día)</option>
              <option value="bodas">Bodas y servicios exclusivos</option>
              <option value="postquirurgico">Postquirúrgico</option>
              <option value="transporte">Transporte</option>
              <option value="exoticos">Exóticos</option>
            </select>
          </div>

          <div class="booking-field">
            <label for="startDate">Fecha de inicio</label>
            <input type="date" id="startDate" name="Fecha_inicio" required>
          </div>
          <div class="booking-field">
            <label for="endDate">Fecha de fin</label>
            <input type="date" id="endDate" name="Fecha_fin" required>
          </div>

          <div class="booking-field">
            <label for="start">Hora de inicio</label>
            <input type="time" id="start" name="Hora_inicio" required>
          </div>
          <div class="booking-field">
            <label for="end">Hora de fin</label>
            <input type="time" id="end" name="Hora_fin" required>
          </div>
        </div>
      </section>

      <!-- Mascota -->
      <section class="tpl-section" aria-labelledby="sec-mascotas">
        <h2 id="sec-mascotas">Mascotas</h2>
        <div class="booking-grid">
          <div class="booking-field" style="grid-column:1/-1">
            <label for="tpl-pet-select">Elige tu mascota (si tienes varias)</label>
            <select id="tpl-pet-select" class="tpl-pet-select">
              <option value="">— Selecciona —</option>
            </select>
          </div>
          <div class="booking-field">
            <label for="petName_1">Nombre de la mascota</label>
            <input type="text" id="petName_1" name="Mascota_1" placeholder="Ej. Nala">
          </div>
          <div class="booking-field">
            <label for="species">Tipo de animal</label>
            <select id="species" name="Tipo_animal">
              <option value="perro">Perro</option>
              <option value="gato">Gato</option>
              <option value="otros">Otros</option>
            </select>
          </div>
        </div>
        <input type="hidden" name="Mascotas_lista" id="petsListHidden">
      </section>

      <!-- Titular -->
      <section class="tpl-section" aria-labelledby="sec-titular">
        <h2 id="sec-titular">Datos de la persona titular</h2>
        <div class="booking-grid">
          <div class="booking-field">
            <label for="firstName">Nombre</label>
            <input type="text" id="firstName" name="Nombre" required autocomplete="given-name">
          </div>
          <div class="booking-field">
            <label for="lastName">Apellidos</label>
            <input type="text" id="lastName" name="Apellidos" required autocomplete="family-name">
          </div>
          <div class="booking-field" style="grid-column:1/-1">
            <label for="location">Dirección</label>
            <input type="text" id="location" name="Direccion" placeholder="Calle y número, piso…" autocomplete="street-address">
          </div>
          <div class="booking-field">
            <label for="region">Comunidad Autónoma</label>
            <select id="region" name="CCAA" required>
              <option value="" disabled hidden>Selecciona tu CCAA…</option>
              <option value="madrid" selected>Comunidad de Madrid</option>
              <option value="andalucia">Andalucía</option>
              <option value="aragon">Aragón</option>
              <option value="asturias">Asturias</option>
              <option value="baleares">Illes Balears</option>
              <option value="canarias">Canarias</option>
              <option value="cantabria">Cantabria</option>
              <option value="castilla-la-mancha">Castilla-La Mancha</option>
              <option value="castilla-y-leon">Castilla y León</option>
              <option value="cataluna">Cataluña</option>
              <option value="valenciana">Comunitat Valenciana</option>
              <option value="extremadura">Extremadura</option>
              <option value="galicia">Galicia</option>
              <option value="la-rioja">La Rioja</option>
              <option value="melilla">Melilla</option>
              <option value="murcia">Región de Murcia</option>
              <option value="navarra">Navarra</option>
              <option value="euskadi">País Vasco</option>
              <option value="ceuta">Ceuta</option>
              <option value="nacional">Solo festivos nacionales</option>
            </select>
          </div>
          <div class="booking-field">
            <label for="postalCode">Código Postal</label>
            <input type="text" id="postalCode" name="CP" inputmode="numeric" pattern="[0-9]{5}" autocomplete="postal-code">
          </div>
          <div class="booking-field">
            <label for="email">Email</label>
            <input type="email" id="email" name="Email" autocomplete="email">
          </div>
          <div class="booking-field">
            <label for="phone">Teléfono</label>
            <input type="tel" id="phone" name="Telefono" autocomplete="tel">
          </div>
        </div>
      </section>

      <!-- Resumen -->
      <section class="tpl-section" aria-labelledby="sec-resumen">
        <h2 id="sec-resumen" class="tpl-hide">Resumen</h2>
        <div class="booking-grid">
          <div class="booking-field">
            <label>Subtotal (orientativo)</label>
            <input type="text" id="sumSubtotal" value="—" readonly>
          </div>
          <div class="booking-field">
            <label>Depósito (20%)</label>
            <input type="text" id="sumDeposit" value="—" readonly>
          </div>
        </div>
        <input type="hidden" name="Desglose" id="summaryField">
      </section>

      <!-- Acciones -->
      <div class="booking-actions">
        <button type="submit" class="cta-button" id="tpl-submit">Solicitar reserva</button>
        <a class="tpl-btn-outline" href="ayuda.html#reservas">Centro de ayuda</a>
      </div>
    </form>
  </div>

  <!-- Overlay éxito -->
  <div id="tpl-overlay" class="tpl-overlay"><div class="tpl-modal"><p></p><button type="button" class="tpl-btn" id="tpl-ov-accept">Aceptar</button></div></div>

  <!-- Footer (inyectado por tpl-footer.js) -->
  <div id="tpl-footer"><noscript><!-- fallback --></noscript></div>

  <!-- Inyectores mínimos -->
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>

  <!-- Firebase compat (misma app que ya usas) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <!-- TPL: INICIO BLOQUE NUEVO [Firebase init] -->
  <script>
  (function(){
    const firebaseConfig = {
      apiKey: "AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
      authDomain: "thepetslovers-c1111.firebaseapp.com",
      projectId: "thepetslovers-c1111",
      storageBucket: "thepetslovers-c1111.appspot.com",
      messagingSenderId: "415914577533",
      appId: "1:415914577533:web:0b7a056ebaa4f1de28ab14"
    };
    if (typeof firebase !== 'undefined' && firebase.apps.length === 0) firebase.initializeApp(firebaseConfig);
  })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->

  <!-- EmailJS SDK + Config (tus IDs) -->
  <!-- TPL: INICIO BLOQUE NUEVO [EmailJS producción] -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    window.TPL_EMAILJS = {
      serviceId: 'service_odjqrfl',
      templateId: 'template_rao5n0c',
      publicKey: 'L2xAATfVuHJwj4EIV',
      admin: 'gestion@thepetslovers.es'
    };
    (function(){
      try{
        if(window.emailjs && window.TPL_EMAILJS?.publicKey){
          emailjs.init({ publicKey: window.TPL_EMAILJS.publicKey });
        }
      }catch(_){}
    })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->

  <!-- Lógica de reservas -->
  <script src="reservas.js" defer></script>
</body>
</html>
