<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Reservas · The Pets Lovers</title>

  <!-- Igual que el resto del sitio -->
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <!-- Canónico + kill-switch (igual que tus páginas) -->
  <script>
    (function(){
      try{var qs=new URLSearchParams(location.search||''); if(qs.get('safe')==='1'){window.__TPL_SAFE_MODE__=true;window.__TPL_DISABLE_CANON__=true;}}catch(_){}
      var CANON='www.thepetslovers.es'; var host=location.hostname||'';
      var IS_DEV=/^(localhost|127\.0\.0\.1|0\.0\.0\.0)$/i.test(host)||/github\.io$/i.test(host);
      if(!window.__TPL_DISABLE_CANON__ && !IS_DEV && host && host!==CANON){
        location.replace(location.protocol+'//'+CANON+location.pathname+location.search+location.hash); return;
      }
    })();
  </script>

  <!-- SEO -->
  <meta name="description" content="Reserva guardería, paseos, visitas a domicilio y alojamiento nocturno con auxiliares veterinarios titulados. Señal ahora, resto 12 días antes." />
  <meta property="og:title" content="Reserva tu servicio · The Pets Lovers" />
  <meta property="og:description" content="Selecciona servicio, fechas y mascotas. Señal ahora y resto 12 días antes." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.thepetslovers.es/reservas.html" />
  <meta property="og:image" content="https://www.thepetslovers.es/images/hero.jpg.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"LocalBusiness","name":"The Pets Lovers","url":"https://www.thepetslovers.es/","logo":"https://www.thepetslovers.es/images/logo.png.png","sameAs":["https://www.instagram.com/guarderiamascotasthepetslovers/"],"areaServed":"España","serviceArea":{"@type":"Country","name":"España"},"description":"Guardería de mascotas y cuidadores profesionales. Auxiliares veterinarios titulados."}
  </script>

  <!-- Firebase global -->
  <script>
    window.TPL_FIREBASE_CONFIG={
      apiKey:"AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
      authDomain:"thepetslovers-c1111.firebaseapp.com",
      projectId:"thepetslovers-c1111",
      storageBucket:"thepetslovers-c1111.appspot.com",
      messagingSenderId:"415914577533",
      appId:"1:415914577533:web:0b7a056ebaa4f1de28ab14",
      measurementId:"G-FXPD69KXBG"
    };
  </script>

  <!-- Hardening + estilos mínimos compatibles con style.css -->
  <style>
    #cookie-modal-overlay[hidden],#cookie-modal-overlay[aria-hidden="true"]{display:none!important;visibility:hidden!important;pointer-events:none!important}
    #tpl-form-overlay:not(.show),.tpl-overlay:not(.on){pointer-events:none!important}
    html,body{pointer-events:auto!important} a,button{pointer-events:auto!important}

    .section{padding:40px 0}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .card{background:#fff;border-radius:12px;border:1px solid #e5e7eb;padding:16px;margin-bottom:16px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:768px){.grid-2{grid-template-columns:1fr}}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:#16a34a;color:#fff}
    .btn-ghost{background:#fff;border:1px solid #e5e7eb}
    .muted{color:#6b7280}
    .disabled{opacity:.55;pointer-events:none}
    label{display:block;margin:6px 0;font-weight:600}
    input,select,textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    textarea{min-height:110px;resize:vertical}
    table.summary{width:100%;border-collapse:separate;border-spacing:0 6px}
    table.summary th,table.summary td{padding:8px 10px;border-bottom:1px dashed #e5e7eb;text-align:left}
    table.summary tr.total th,table.summary tr.total td{font-weight:700;border-bottom:none}

    /* Mascotas: línea limpia sin imágenes */
    .pets-list{display:grid;grid-template-columns:1fr;gap:8px}
    .pet-line{display:flex;align-items:center;gap:10px;border:1px solid #e5e7eb;border-radius:10px;padding:10px;background:#fff}
    .pet-line input[type=checkbox]{width:18px;height:18px}
    .pet-meta{display:flex;gap:8px;align-items:center}
    .badge{font-size:11px;border-radius:999px;padding:2px 6px;border:1px solid #c7d2fe;background:#eef2ff;color:#3730a3}
  </style>
</head>
<body>

  <!-- Navbar (inyectada) -->
  <div id="tpl-navbar">
    <noscript>
      <nav class="navbar">
        <div class="logo"><a href="index.html"><img src="images/logo.png.png" alt="The Pets Lovers"></a></div>
        <a href="index.html" class="home-button">Inicio</a>
        <ul class="nav-links">
          <li><a href="como-funciona.html">Cómo funciona</a></li>
          <li><a href="servicios.html">Servicios</a></li>
          <li><a href="index.html#contactanos">Contáctanos</a></li>
          <li><a href="index.html#hazte-cuidador">Conviértete en cuidador</a></li>
        </ul>
        <a class="login-button" href="iniciar-sesion.html?next=perfil.html">Iniciar sesión</a>
      </nav>
    </noscript>
  </div>

  <!-- Hero consistente -->
  <header class="hero-section">
    <div class="hero-content">
      <h1>Reserva tu servicio</h1>
      <p>Selecciona servicio, fechas y mascotas. Señal ahora y resto 12 días antes.</p>
      <a href="#formulario" class="cta-button">Empezar</a>
    </div>
  </header>

  <!-- Muro de login -->
  <section class="section">
    <div class="container">
      <div id="authWall" class="card" style="display:none">
        <h2 style="margin:0 0 8px">Inicia sesión para reservar</h2>
        <p class="muted">Para continuar debes iniciar sesión o crear tu cuenta.</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn btn-primary" href="iniciar-sesion.html?next=reservas.html"><i class="fa-solid fa-right-to-bracket"></i> Iniciar sesión</a>
          <a class="btn btn-ghost" href="crear-cuenta.html"><i class="fa-solid fa-user-plus"></i> Crear cuenta</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Formulario -->
  <section id="formulario" class="section">
    <div class="container">
      <button type="button" class="btn btn-ghost" id="btnBack" style="margin-bottom:12px">
        <i class="fa-solid fa-arrow-left"></i> Atrás
      </button>

      <form id="bookingForm" class="card disabled" data-tpl-redirect="perfil.html" data-tpl-wait="800">
        <!-- 1) Servicio y fechas/horas -->
        <div class="card">
          <h2>Selecciona el servicio y la fecha</h2>
          <div class="grid-2">
            <div>
              <label for="service">Servicio</label>
              <select id="service" name="service" required>
                <option value="">Selecciona…</option>
                <option value="guarderia">Guardería de día</option>
                <option value="alojamiento">Alojamiento nocturno</option>
                <option value="paseos">Paseo (60’)</option>
                <option value="visitas">Visita a domicilio (gato)</option>
                <option value="exoticos">Exóticos</option>
                <option value="transporte">Transporte</option>
              </select>
            </div>
            <div>
              <label for="startDate">Fecha inicio</label>
              <input id="startDate" name="startDate" type="date" required />
            </div>
            <div>
              <label for="endDate">Fecha fin</label>
              <input id="endDate" name="endDate" type="date" required />
            </div>
            <div>
              <label for="startTime">Hora inicio</label>
              <input id="startTime" name="Hora_inicio" type="time" />
            </div>
            <div>
              <label for="endTime">Hora fin</label>
              <input id="endTime" name="Hora_fin" type="time" />
            </div>
          </div>
          <div id="speciesBlock" style="display:none; margin-top:10px">
            <label for="species">Especie (solo visitas/exóticos)</label>
            <select id="species" name="species">
              <option value="gato">Gato</option>
              <option value="perro">Perro</option>
              <option value="conejo">Conejo</option>
              <option value="pajaro">Pájaro</option>
              <option value="huron">Hurón</option>
              <option value="iguana">Iguana</option>
              <option value="otro">Otro exótico</option>
            </select>
          </div>
        </div>

        <!-- 2) Mascotas -->
        <div class="card" id="petsAnchor">
          <h2>Mascotas</h2>
          <section id="petsList" class="pets-list"></section>
          <p class="muted">Selecciona hasta 3 mascotas para esta reserva.</p>
        </div>

        <!-- 3) Datos del titular -->
        <div class="card">
          <h2>Datos del titular</h2>
          <div class="grid-2">
            <div>
              <label for="firstName">Nombre y apellidos</label>
              <input id="firstName" name="firstName" required />
              <input id="lastName" name="lastName" style="display:none" />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" required />
            </div>
            <div>
              <label for="phone">Teléfono</label>
              <input id="phone" name="phone" required />
            </div>
            <div>
              <label for="region">Comunidad Autónoma</label>
              <select id="region" name="region" required>
                <option value="">Selecciona…</option>
                <option>Andalucía</option><option>Aragón</option><option>Asturias</option><option>Baleares</option>
                <option>Canarias</option><option>Cantabria</option><option>Castilla-La Mancha</option><option>Castilla y León</option>
                <option>Cataluña</option><option>Comunidad Valenciana</option><option>Extremadura</option><option>Galicia</option>
                <option>La Rioja</option><option>Madrid</option><option>Murcia</option><option>Navarra</option>
                <option>País Vasco</option><option>Ceuta</option><option>Melilla</option>
              </select>
            </div>
            <div>
              <label for="address">Dirección</label>
              <input id="address" name="address" placeholder="Calle, nº, piso…" />
            </div>
            <div>
              <label for="postalCode">Código Postal</label>
              <input id="postalCode" name="postalCode" placeholder="28001" />
            </div>
            <div class="full">
              <label for="observations">Observaciones</label>
              <textarea id="observations" name="observations" placeholder="Llaves, timbre, alergias…"></textarea>
            </div>
          </div>
        </div>

        <!-- 4) Desglose -->
        <div class="card">
          <h2>Desglose</h2>
          <table class="summary">
            <thead><tr><th>Concepto</th><th>Importe</th></tr></thead>
            <tbody id="summaryBody">
              <tr><th>Base suelto</th><td id="sumBase">0.00</td></tr>
              <tr><th>Visitas (principal)</th><td id="sumVisit1">0.00</td></tr>
              <tr><th>Visitas (medicación)</th><td id="sumVisit2">0.00</td></tr>
              <tr><th>Suplementos/bono</th><td id="sumFestivo">0.00</td></tr>
              <tr><th>Días</th><td id="sumSenalado">0</td></tr>
              <tr><th>Suplementos mascotas</th><td id="sumPets">0.00</td></tr>
              <tr class="total"><th>Subtotal</th><td id="sumSubtotal">0.00</td></tr>
              <tr class="total"><th>A pagar ahora</th><td id="sumDeposit">0.00</td></tr>
              <tr class="total"><th>Pendiente (12 días antes)</th><td id="sumResto">0.00</td></tr>
            </tbody>
          </table>
          <input type="hidden" id="summaryField" name="summaryField" value="" />
          <p class="muted" style="margin-top:8px">
            Solo abonarás una pequeña parte ahora. El resto se pagará <strong>12 días antes</strong> del inicio del servicio.
          </p>
        </div>

        <!-- 5) CTA -->
        <div style="display:flex;gap:10px;justify-content:flex-end">
          <button type="submit" class="btn btn-primary"><i class="fa-solid fa-lock"></i> Reservar ahora</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Footer (inyectado cuando no hay JS) -->
  <div id="tpl-footer">
    <noscript>
      <footer class="site-footer">
        <div class="container footer-row">
          <div class="footer-left">
            <nav class="footer-links-row">
              <a href="sobre-nosotros.html">Sobre nosotros</a><span class="sep">|</span>
              <a href="contacto.html">Contacta con nosotros</a><span class="sep">|</span>
              <a href="donde-estamos.html">Dónde estamos</a><span class="sep">|</span>
              <a href="trabaja-con-nosotros.html">Trabaja con nosotros</a><span class="sep">|</span>
              <a href="privacidad.html">Política de Privacidad</a><span class="sep">|</span>
              <a href="condiciones.html">Condiciones de Servicio</a><span class="sep">|</span>
              <a href="digital-services-act.html">Digital Services Act</a>
            </nav>
            <div class="footer-help">¿Necesitas ayuda? <a href="ayuda.html">Centro de ayuda</a></div>
          </div>
          <div class="footer-right socials">
            <a href="#" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
          </div>
        </div>
        <div class="footer-bottom footer-bottom--inline">
          <div class="footer-bottom-left">© <span class="year-span"></span> The Pets Lovers — Todos los derechos reservados</div>
          <nav class="footer-bottom-right legal-links">
            <a href="aviso-legal.html">Aviso legal</a><span class="sep">|</span>
            <a href="privacidad.html">Privacidad</a><span class="sep">|</span>
            <a href="cookies.html">Cookies</a><span class="sep">|</span>
            <a href="canal-denuncias.html">Canal de denuncias</a>
          </nav>
        </div>
      </footer>
    </noscript>
  </div>

  <script>document.querySelectorAll('.year-span').forEach(s=>s.textContent=new Date().getFullYear());</script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>(function(){if(typeof firebase!=='undefined'&&!firebase.apps.length&&window.TPL_FIREBASE_CONFIG){firebase.initializeApp(window.TPL_FIREBASE_CONFIG);}})();</script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    window.TPL_EMAILJS=window.TPL_EMAILJS||{
      serviceId:"service_odjqrfl",
      publicKey:"L2xAATfVuHJwj4EIV",
      templates:{cliente:"template_rao5n0c",gestion:"template_rao5n0c"},
      adminEmail:"gestion@thepetslovers.es"
    };
    try{ if(window.TPL_EMAILJS.publicKey){ emailjs.init(window.TPL_EMAILJS.publicKey); } }catch(e){}
  </script>

  <!-- Scripts globales del sitio -->
  <script src="script.js"></script>
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>
  <script src="tpl-auth.js" defer></script>

  <!-- Lógica de reservas -->
  <script src="js/reservas.js" defer></script>

  <!-- Antibloqueo base + ultra -->
  <script>
    (function(){
      try{
        document.documentElement.classList.remove('tpl-auth-boot');
        var ov=document.getElementById('tpl-form-overlay'); if(ov) ov.classList.remove('show');
        var cov=document.getElementById('cookie-modal-overlay'); if(cov){ cov.hidden=true; cov.style.display='none'; cov.setAttribute('aria-hidden','true'); }
        window.addEventListener('load', function(){
          document.documentElement.classList.remove('tpl-auth-boot');
          var ov2=document.getElementById('tpl-form-overlay'); if(ov2) ov2.classList.remove('show');
          var cov2=document.getElementById('cookie-modal-overlay'); if(cov2){ cov2.hidden=true; cov2.style.display='none'; cov2.setAttribute('aria-hidden','true'); }
        });
      }catch(_){}
    })();
  </script>
  <script>
    (function(){
      function off(el){try{el.style.setProperty('pointer-events','none','important');if(!/(^|\s)(on|show|active)(\s|$)/i.test(el.className||'')){el.style.setProperty('display','none','important');el.setAttribute('aria-hidden','true');}}catch(_){}} 
      function isCover(el){if(!el||!el.getBoundingClientRect)return false;var r=el.getBoundingClientRect(),w=innerWidth,h=innerHeight;var cs=getComputedStyle(el),pos=cs.position;var big=(r.width>=w*0.85&&r.height>=h*0.85);var covering=(pos==='fixed'||pos==='absolute')&&big&&cs.display!=='none'&&cs.visibility!=='hidden';var id=(el.id||'')+' '+(el.className||'');var isNav=/navbar/.test(id)||el.closest&&el.closest('.navbar');return covering&&!isNav;}
      function topAt(x,y){var el=document.elementFromPoint(x,y);return el&&el.nodeType===3?el.parentElement:el;}
      function scan(){document.documentElement.style.setProperty('pointer-events','auto','important');document.body.style.setProperty('pointer-events','auto','important');document.body.removeAttribute('inert');var cov=document.getElementById('cookie-modal-overlay');if(cov&&cov.getAttribute('aria-hidden')==='true')off(cov);var ov=document.getElementById('tpl-form-overlay');if(ov&&!ov.classList.contains('show'))off(ov);document.querySelectorAll('.tpl-overlay').forEach(function(el){if(!el.classList.contains('on'))off(el);});[[8,8],[innerWidth/2,56],[innerWidth/2,innerHeight/2],[innerWidth-8,8],[innerWidth/2,innerHeight-8]].forEach(function(p){var el=topAt(p[0],p[1]);if(el){var cur=el;for(var i=0;i<5&&cur;i++){if(isCover(cur)){off(cur);break;}cur=cur.parentElement;}}});}
      if(document.readyState!=='loading')scan();else document.addEventListener('DOMContentLoaded',scan);
      addEventListener('load',scan);setTimeout(scan,200);setTimeout(scan,700);setTimeout(scan,1500);
      document.addEventListener('click',function once(){scan();document.removeEventListener('click',once);});
    })();
  </script>
</body>
</html>
