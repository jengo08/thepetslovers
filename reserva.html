<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Reserva · The Pets Lovers</title>
  <meta name="description" content="Reserva guardería, alojamiento, paseos, visitas a gatos, exóticos o transporte con The Pets Lovers.">
  <link rel="canonical" href="https://www.thepetslovers.es/reservas.html">
  <meta name="robots" content="index,follow">
  <meta property="og:title" content="Reserva · The Pets Lovers">
  <meta property="og:description" content="Selecciona servicio, fechas y mascotas. Solo pagas ahora una pequeña parte.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/images/og-petslovers.jpg">

  <!-- Estilos globales -->
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <!-- Ajustes visuales compactos (no gigantes) -->
  <style>
    :root{--tpl-brand:#111827;--tpl-muted:#6b7280;--tpl-border:#e5e7eb;--tpl-bg:#f9fafb;--tpl-primary:#339496}
    body{background:#fff}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    .hero{padding:18px 0 6px}
    .sub{color:var(--tpl-muted);margin-top:4px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .card{border:1px solid var(--tpl-border);border-radius:14px;padding:16px;background:#fff}
    label{font-size:14px;color:#374151}
    input,select,textarea{width:100%;padding:9px;border:1px solid #d1d5db;border-radius:10px;font-size:15px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--tpl-primary);color:#fff}
    .btn-ghost{background:#fff;border:1px solid var(--tpl-border);color:#111827}
    .muted{color:var(--tpl-muted);font-size:12px}
    .section-title{font-weight:700;margin:4px 0 8px}
    .disabled{opacity:.6;pointer-events:none;filter:grayscale(1)}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:var(--tpl-bg);border:1px solid var(--tpl-border);font-size:12px;color:#374151}
    .summary{background:var(--tpl-bg)}
    .summary .line{display:flex;justify-content:space-between;margin:6px 0}
    .summary .total{font-weight:700;border-top:1px dashed var(--tpl-border);padding-top:8px;margin-top:6px}
    .gate{border:2px dashed var(--tpl-border);background:#fffcee}
    .pets-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (min-width:900px){.pets-grid{grid-template-columns:repeat(3,minmax(0,1fr));}}
    .pet-card{display:flex;gap:10px;border:1px solid var(--tpl-border);border-radius:12px;padding:8px;align-items:center;background:#fff}
    .pet-card input[type=checkbox]{width:18px;height:18px}
    .pet-img{width:46px;height:46px;flex:0 0 46px;border-radius:50%;object-fit:cover;border:1px solid var(--tpl-border)}
    .pet-meta{font-size:12px;color:#4b5563}
    .badge{font-size:11px;border-radius:999px;padding:2px 6px;border:1px solid var(--tpl-border);background:#eefaf9;color:#0f766e}
  </style>

  <!-- Redirección defensiva si alguien entra en /reservas (sin .html) -->
  <script>
    (function(){
      var p = location.pathname.replace(/\/+$/,'');
      if(p==="/reservas"){ location.replace("/reservas.html"+location.search+location.hash); }
    })();
  </script>
</head>
<body>

  <!-- Navbar -->
  <div id="tpl-navbar"></div>

  <main class="wrap">
    <div class="hero">
      <h1>Reserva tu servicio</h1>
      <p class="sub">Selecciona servicio, fechas y mascotas. Solo pagas ahora una pequeña parte.</p>
    </div>

    <!-- Auth gate -->
    <div id="sessionGate" class="card gate" style="display:none">
      <h3 style="margin:0 0 8px">Inicia sesión para reservar</h3>
      <p class="muted" style="margin:0 0 12px">Para continuar debes iniciar sesión o crear tu perfil.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn btn-primary" href="/login.html"><i class="fa-solid fa-right-to-bracket"></i> Iniciar sesión</a>
        <a class="btn btn-ghost" href="/crear-cuenta.html"><i class="fa-solid fa-user-plus"></i> Crear cuenta</a>
      </div>
    </div>

    <!-- Formulario -->
    <form id="reservaForm" class="card disabled" novalidate>
      <!-- Datos del servicio -->
      <div class="section-title">Datos del servicio</div>
      <div class="grid-3">
        <div>
          <label>Servicio</label>
          <select id="serviceType" required>
            <option value="">Selecciona…</option>
            <option value="guarderia_dia">Guardería de día</option>
            <option value="alojamiento_nocturno">Alojamiento nocturno</option>
            <option value="paseo">Paseo (60’)</option>
            <option value="visita_gato">Visita a domicilio (gato)</option>
            <option value="exoticos_aves">Visita exóticos (aves)</option>
            <option value="exoticos_reptiles">Visita exóticos (reptiles)</option>
            <option value="exoticos_mamiferos">Visita exóticos (mamíferos pequeños)</option>
            <option value="transporte">Transporte</option>
          </select>
        </div>

        <div>
          <label>Fecha inicio</label>
          <input id="startDate" type="date" required>
        </div>
        <div>
          <label>Fecha fin</label>
          <input id="endDate" type="date" required>
        </div>

        <div>
          <label>Hora inicio</label>
          <input id="startTime" type="time">
        </div>
        <div>
          <label>Hora fin</label>
          <input id="endTime" type="time">
        </div>

        <!-- Controles visita gato -->
        <div id="visitCatControls" style="display:none">
          <label>Visita gato — duración y nº de visitas/día</label>
          <div class="grid-2">
            <select id="vgDuration">
              <option value="60">60 minutos</option>
              <option value="90">90 minutos</option>
            </select>
            <select id="vgPerDay">
              <option value="1">1 visita/día</option>
              <option value="2">2 visitas/día (extra 15’)</option>
            </select>
          </div>
          <p class="muted" style="margin:6px 0 0">La segunda visita (15’) son 12 €; desde el día 11 son 10 €.</p>
        </div>
      </div>

      <!-- Mascotas -->
      <div style="margin-top:14px" class="section-title">Mascotas (elige una o varias)</div>

      <div class="grid-3">
        <div>
          <label>Número de mascotas</label>
          <select id="petsCount">
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
        </div>
        <div>
          <label>Filtrar especie</label>
          <select id="petsFilter">
            <option value="">Todas</option>
            <option value="perro">Perros</option>
            <option value="gato">Gatos</option>
            <option value="exotico">Exóticos</option>
          </select>
        </div>
      </div>

      <div id="petsGrid" class="pets-grid" style="margin-top:10px"></div>
      <p class="muted" id="petsHint" style="margin-top:6px">Selecciona hasta el número indicado.</p>

      <!-- Datos titular -->
      <div style="margin-top:14px" class="section-title">Datos del titular</div>
      <div class="grid-3">
        <div>
          <label>Nombre y apellidos</label>
          <input id="ownerFullName" required>
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" required>
        </div>
        <div>
          <label>Teléfono</label>
          <input id="phone" required>
        </div>
        <div>
          <label>Comunidad Autónoma</label>
          <select id="region" required>
            <option value="">Selecciona…</option>
            <option>Andalucía</option><option>Aragón</option><option>Asturias</option><option>Baleares</option>
            <option>Canarias</option><option>Cantabria</option><option>Castilla-La Mancha</option><option>Castilla y León</option>
            <option>Cataluña</option><option>Comunidad Valenciana</option><option>Extremadura</option><option>Galicia</option>
            <option>La Rioja</option><option>Madrid</option><option>Murcia</option><option>Navarra</option><option>País Vasco</option><option>Ceuta</option><option>Melilla</option>
          </select>
        </div>
        <div>
          <label>Dirección</label>
          <input id="address" placeholder="">
        </div>
        <div>
          <label>Código Postal</label>
          <input id="postalCode" placeholder="28001">
        </div>
        <div>
          <label>¿Necesitas desplazamiento?</label>
          <select id="travelNeeded">
            <option value="no">No</option>
            <option value="si">Sí (se calculará al asignar cuidador)</option>
          </select>
        </div>
        <div>
          <label>Preferencia de contacto</label>
          <select id="contactPref">
            <option>Teléfono</option><option>WhatsApp</option><option>Email</option><option>Cualquiera</option>
          </select>
        </div>
        <div>
          <label>Franja preferida</label>
          <select id="contactTime">
            <option>Mañana</option><option>Tarde</option><option>Noche</option>
          </select>
        </div>
        <div>
          <label>Contacto de emergencia</label>
          <input id="emergencyName">
        </div>
        <div>
          <label>Teléfono emergencia</label>
          <input id="emergencyPhone">
        </div>
        <div class="grid-2" style="grid-column:1/-1">
          <div>
            <label>Observaciones</label>
            <textarea id="notes" rows="2" placeholder=""></textarea>
          </div>
        </div>
      </div>

      <!-- Desglose -->
      <div class="card summary" style="margin-top:16px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div><strong>Resumen</strong></div>
          <span id="summaryContext" class="pill">—</span>
        </div>
        <div id="summaryLines" style="margin-top:8px"></div>
        <div class="line total"><span>Subtotal</span><span id="subtotalTxt">—</span></div>
        <div class="line"><span>A pagar ahora</span><span id="payNowTxt">—</span></div>
        <div class="line"><span>Pendiente (12 días antes)</span><span id="payLaterTxt">—</span></div>
        <p class="muted" style="margin-top:8px">Solo abonarás una pequeña parte ahora. El resto se pagará <strong>12 días antes</strong> del inicio del servicio.</p>
      </div>

      <!-- CTA -->
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
        <a href="/servicios.html" class="btn btn-ghost"><i class="fa-solid fa-arrow-left"></i> Atrás</a>
        <button id="btnReserve" type="button" class="btn btn-primary"><i class="fa-solid fa-lock"></i> Reservar ahora</button>
      </div>
    </form>

    <!-- Gracias -->
    <div id="thanks" class="card" style="display:none">
      <h3>¡Gracias! Tu solicitud está en revisión</h3>
      <p class="muted">Te llamaremos para confirmar los datos y asignarte el mejor cuidador. Una vez confirmado, pagarás el resto 12 días antes del inicio.</p>
      <a class="btn btn-ghost" href="/perfil.html"><i class="fa-solid fa-user"></i> Ir a mi perfil</a>
    </div>
  </main>

  <!-- Footer -->
  <div id="tpl-footer"></div>

  <!-- Navbar/Footer inyectados -->
  <script src="/tpl-navbar.js" defer></script>
  <script src="/tpl-footer.js" defer></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    (function(){
      if (typeof firebase!=='undefined' && !firebase.apps.length) {
        firebase.initializeApp({
          apiKey: "AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
          authDomain: "thepetslovers-c1111.firebaseapp.com",
          projectId: "thepetslovers-c1111",
          storageBucket: "thepetslovers-c1111.appspot.com",
          messagingSenderId: "415914577533",
          appId: "1:415914577533:web:0b7a056ebaa4f1de28ab14",
          measurementId: "G-FXPD69KXBG"
        });
      }
    })();
  </script>

  <!-- EmailJS (tu plantilla única) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    window.EMAILJS = {
      enabled: true,
      service_id: "service_odjqrfl",
      template_id: "template_rao5n0c",
      public_key: "L2xAATfVuHJwj4EIV",
      admin_email: "gestion@thepetslovers.es"
    };
    try{ emailjs.init(EMAILJS.public_key); }catch(e){}
  </script>

  <!-- Bridge de sesión + lógica reservas -->
  <script src="/tpl-auth-bridge.js"></script>
  <script src="/tpl-reservas.js"></script>
</body>
</html>
