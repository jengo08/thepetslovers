<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cuestionario de Candidaturas · The Pets Lovers</title>
  <meta name="description" content="Envía tu candidatura para cuidador/a en The Pets Lovers. Sube tu CV y tu título y cuéntanos tu experiencia y disponibilidad.">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    .tpl-page{ padding-top:120px; }
    .tpl-form{ max-width: 860px; margin: 0 auto 80px; padding: 18px; background:#fff; border:1px solid #eee; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,.05); }
    .tpl-form h1{ margin: 0 0 8px; }
    .tpl-lead{ color:#555; margin:0 0 18px; }
    .tpl-grid{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media (min-width: 900px){ .tpl-grid{ grid-template-columns:1fr 1fr; } }
    .tpl-field{ display:flex; flex-direction:column; gap:6px; }
    .tpl-field label{ font-weight:700; color:#58425a; }
    .tpl-field input[type="text"],
    .tpl-field input[type="email"],
    .tpl-field input[type="tel"],
    .tpl-field textarea,
    .tpl-field select{
      border:1px solid #ddd; border-radius:10px; padding:10px; font:inherit;
    }
    .tpl-field input[type="file"]{ border:1px dashed #bbb; border-radius:10px; padding:12px; background:#fafafa; }
    .tpl-full{ grid-column:1 / -1; }
    .tpl-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }
    .tpl-note{ font-size:.92rem; color:#555; }
    .tpl-ok{ color:#2e7d32; }
    .tpl-error{ color:#b00020; }
    .tpl-badge{ display:inline-flex; gap:6px; align-items:center; background:#f5fbfb; color:#339496; padding:8px 10px; border:1px solid #d7efef; border-radius:999px; font-weight:700; }
    .cta-button{ display:inline-block; background:var(--color-principal,#339496); color:#fff; padding:12px 18px; border-radius:999px; border:2px solid transparent; text-decoration:none; font-weight:700; text-align:center; }
    .cta-button[disabled]{ opacity:.6; cursor:not-allowed; }
  </style>
</head>
<body>
  <div id="tpl-navbar"></div>

  <main class="tpl-page">
    <section class="tpl-form" aria-labelledby="t">
      <p class="tpl-badge"><i class="fa-solid fa-shield-cat"></i> Profesionales del sector veterinario</p>
      <h1 id="t">Cuestionario de candidaturas</h1>
      <p class="tpl-lead">Cuéntanos tu perfil y adjunta tu <strong>CV</strong> y <strong>título</strong>. Tratamos los datos según la <a href="privacidad.html">Política de privacidad</a>.</p>

      <!-- TPL: INICIO BLOQUE NUEVO [Formulario + Formspree] -->
      <form id="tpl-candidatura-form" action="https://formspree.io/f/mpwjjoyq" method="POST" enctype="multipart/form-data">
        <div class="tpl-grid">
          <div class="tpl-field">
            <label for="nombre">Nombre y apellidos</label>
            <input id="nombre" name="nombre" type="text" required autocomplete="name" />
          </div>
          <div class="tpl-field">
            <label for="email">Email</label>
            <input id="email" name="_replyto" type="email" required autocomplete="email" />
          </div>
          <div class="tpl-field">
            <label for="telefono">Teléfono</label>
            <input id="telefono" name="telefono" type="tel" inputmode="tel" autocomplete="tel" />
          </div>
          <div class="tpl-field">
            <label for="provincia">Provincia / zona</label>
            <input id="provincia" name="provincia" type="text" required />
          </div>
          <div class="tpl-field">
            <label for="rol">Rol</label>
            <select id="rol" name="rol" required>
              <option value="">Selecciona</option>
              <option value="Auxiliar de Veterinaria">Auxiliar de Veterinaria</option>
              <option value="Veterinario/a">Veterinario/a</option>
            </select>
          </div>
          <div class="tpl-field">
            <label for="disponibilidad">Disponibilidad</label>
            <select id="disponibilidad" name="disponibilidad" required>
              <option value="">Selecciona</option>
              <option>Mañanas</option><option>Tardes</option><option>Noches</option>
              <option>Fines de semana</option><option>Completa</option>
            </select>
          </div>

          <div class="tpl-field tpl-full">
            <label for="experiencia">Experiencia (breve)</label>
            <textarea id="experiencia" name="experiencia" rows="3" placeholder="Años de experiencia, tipos de mascotas, clínicas…"></textarea>
          </div>

          <div class="tpl-field">
            <label for="cv">CV (PDF)</label>
            <input id="cv" name="cv" type="file" accept=".pdf" required />
          </div>
          <div class="tpl-field">
            <label for="titulo">Título (PDF o imagen)</label>
            <input id="titulo" name="titulo" type="file" accept=".pdf,.png,.jpg,.jpeg" required />
          </div>

          <div class="tpl-field tpl-full">
            <label for="links">Enlaces (Instagram/LinkedIn/portfolio)</label>
            <input id="links" name="links" type="text" placeholder="https://..." />
          </div>

          <div class="tpl-field tpl-full">
            <label class="tpl-note">
              <input type="checkbox" id="acepto" required />
              He leído y acepto la <a href="privacidad.html">Política de privacidad</a>.
            </label>
          </div>
        </div>

        <!-- Campos ocultos para URLs subidas a Firebase -->
        <input type="hidden" id="cvUrl" name="cvUrl">
        <input type="hidden" id="tituloUrl" name="tituloUrl">

        <div class="tpl-actions">
          <button id="tpl-submit" class="cta-button" type="submit">Enviar candidatura</button>
        </div>
        <p id="tpl-status" aria-live="polite" class="tpl-note" style="margin-top:8px;"></p>
      </form>
      <!-- TPL: FIN BLOQUE NUEVO -->
    </section>
  </main>

  <div id="tpl-footer"></div>
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>

  <!-- Firebase compat (alineado con tu proyecto) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>

  <!-- TPL: INICIO BLOQUE NUEVO [Config Firebase: reutiliza la misma de reserva.html] -->
  <script>
    // Si YA has inicializado Firebase en otra página, esto respeta la instancia.
    (function(){
      if (typeof firebase === 'undefined') return;
      if (!firebase.apps.length) {
        // COPIA los mismos valores que tienes en reserva.html (ya los tienes ahí):
        const firebaseConfig = {
          apiKey: "AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
          authDomain: "thepetslovers-c1111.firebaseapp.com",
          projectId: "thepetslovers-c1111",
          storageBucket: "thepetslovers-c1111.appspot.com",
          messagingSenderId: "415914577533",
          appId: "1:415914577533:web:0b7a056ebaa4f1de28ab14",
          measurementId: "G-FXPD69KXBG"
        };
        firebase.initializeApp(firebaseConfig);
      }
    })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->

  <!-- TPL: INICIO BLOQUE NUEVO [Subida a Storage + guardado en Firestore + envío Formspree] -->
  <script>
    (function(){
      if (typeof firebase === 'undefined') return;

      const form = document.getElementById('tpl-candidatura-form');
      const btn  = document.getElementById('tpl-submit');
      const stEl = document.getElementById('tpl-status');

      function setStatus(html){ stEl.innerHTML = html || ''; }

      async function uploadToStorage(file, path){
        const storage = firebase.storage();
        const safe = file.name.replace(/[^a-zA-Z0-9._-]/g,'_');
        const ref = storage.ref().child(`${path}/${Date.now()}_${safe}`);
        await ref.put(file);
        return await ref.getDownloadURL();
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        btn.disabled = true; setStatus('Subiendo archivos…');

        try{
          const fd = new FormData(form);
          const rol = fd.get('rol') || 'otros';
          const cvFile = document.getElementById('cv').files[0];
          const tiFile = document.getElementById('titulo').files[0];

          const [cvUrl, tituloUrl] = await Promise.all([
            uploadToStorage(cvFile,   `candidaturas/${rol}/cv`),
            uploadToStorage(tiFile,   `candidaturas/${rol}/titulos`)
          ]);

          // Guardar ficha en Firestore
          const db = firebase.firestore();
          await db.collection('candidaturas').add({
            nombre: fd.get('nombre') || '',
            email: fd.get('_replyto') || '',
            telefono: fd.get('telefono') || '',
            provincia: fd.get('provincia') || '',
            rol: fd.get('rol') || '',
            disponibilidad: fd.get('disponibilidad') || '',
            experiencia: fd.get('experiencia') || '',
            links: fd.get('links') || '',
            cvUrl, tituloUrl,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          // Enviar a Formspree con URLs incluidas
          document.getElementById('cvUrl').value = cvUrl;
          document.getElementById('tituloUrl').value = tituloUrl;

          setStatus('<span class="tpl-ok">¡Listo! Archivos subidos. Enviando formulario…</span>');
          form.submit();
        }catch(err){
          console.error(err);
          setStatus('<span class="tpl-error">No se pudo subir a Firebase. Enviaremos igualmente tu candidatura por email.</span>');
          form.submit();
        }finally{
          btn.disabled = false;
        }
      });
    })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->
</body>
</html>
