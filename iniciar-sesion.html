<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Iniciar sesión · The Pets Lovers</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .tpl-login{ max-width:460px; margin:120px auto; padding:18px; background:#fff; border:1px solid #eee; border-radius:12px; }
    .tpl-field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .tpl-field input{ border:1px solid #ddd; border-radius:10px; padding:10px; font:inherit; }
    .tpl-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .cta-button{ background:#339496; color:#fff; padding:10px 16px; border-radius:999px; border:none; cursor:pointer; font-weight:700; }
    .link{ background:#fff; color:#339496; border:2px solid #339496; }
    .msg{ margin-top:8px; color:#555; }
  </style>
</head>
<body>
  <div id="tpl-navbar"></div>

  <main class="tpl-login">
    <h1>Iniciar sesión</h1>
    <div class="tpl-field">
      <label for="email">Email</label>
      <input id="email" type="email" autocomplete="email" required>
    </div>
    <div class="tpl-field">
      <label for="pass">Contraseña</label>
      <input id="pass" type="password" autocomplete="current-password" required>
    </div>
    <div class="tpl-actions">
      <button id="btnLogin" class="cta-button">Entrar</button>
      <button id="btnSignup" class="cta-button link" type="button">Crear cuenta</button>
      <button id="btnLogout" class="cta-button link" type="button" style="display:none">Cerrar sesión</button>
    </div>
    <p id="msg" class="msg" aria-live="polite"></p>
  </main>

  <div id="tpl-footer"></div>
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>

  <!-- TPL: INICIO BLOQUE NUEVO [Firebase Auth email/password] -->
  <script type="module">
    import { initializeApp, getApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    let app = getApps().length ? getApp() : initializeApp(window.__TPL_FIREBASE_CONFIG);
    const auth = getAuth(app);

    const $ = (id)=>document.getElementById(id);
    const email = $('email'), pass = $('pass');
    const msg = $('msg'), btnLogin = $('btnLogin'), btnSignup = $('btnSignup'), btnLogout = $('btnLogout');

    function setStatus(text){ msg.textContent = text || ''; }

    onAuthStateChanged(auth, (user)=>{
      if (user){
        localStorage.setItem('tpl-auth','1'); // tu web ya usa esto para mostrar/ocultar CTAs
        btnLogout.style.display = 'inline-block';
        setStatus('Sesión iniciada');
      }else{
        localStorage.removeItem('tpl-auth');
        btnLogout.style.display = 'none';
        setStatus('');
      }
    });

    btnLogin.addEventListener('click', async ()=>{
      try{
        await signInWithEmailAndPassword(auth, email.value, pass.value);
        setStatus('¡Bienvenido/a!'); setTimeout(()=> location.href='index.html', 600);
      }catch(e){ setStatus('No se pudo iniciar sesión. Revisa email/contraseña.'); }
    });

    btnSignup.addEventListener('click', async ()=>{
      try{
        await createUserWithEmailAndPassword(auth, email.value, pass.value);
        setStatus('Cuenta creada. Has iniciado sesión.'); setTimeout(()=> location.href='index.html', 600);
      }catch(e){ setStatus('No se pudo crear la cuenta. ¿Ya existe ese email?'); }
    });

    btnLogout.addEventListener('click', async ()=>{
      await signOut(auth);
      setStatus('Has cerrado sesión.');
    });
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->
</body>
</html>
