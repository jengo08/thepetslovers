<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Iniciar sesión · The Pets Lovers</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .tpl-login{ max-width:460px; margin:120px auto; padding:18px; background:#fff; border:1px solid #eee; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,.05); }
    .tpl-field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .tpl-field label{ font-weight:700; color:#58425a; }
    .tpl-field input{ border:1px solid #ddd; border-radius:10px; padding:10px; font:inherit; }
    .tpl-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .cta-button{ background:#339496; color:#fff; padding:10px 16px; border-radius:999px; border:none; cursor:pointer; font-weight:700; }
    .link{ background:#fff; color:#339496; border:2px solid #339496; }
    .msg{ margin-top:8px; color:#555; min-height:1.2em; }
  </style>
</head>
<body>
  <div id="tpl-navbar"></div>

  <main class="tpl-login" aria-labelledby="t">
    <h1 id="t">Iniciar sesión</h1>

    <div class="tpl-field">
      <label for="email">Email</label>
      <input id="email" type="email" autocomplete="email" required>
    </div>
    <div class="tpl-field">
      <label for="pass">Contraseña</label>
      <input id="pass" type="password" autocomplete="current-password" required>
    </div>

    <div class="tpl-actions">
      <button id="btnLogin" class="cta-button" type="button">Entrar</button>
      <button id="btnSignup" class="cta-button link" type="button">Crear cuenta</button>
      <button id="btnLogout" class="cta-button link" type="button" style="display:none">Cerrar sesión</button>
    </div>

    <p id="msg" class="msg" aria-live="polite"></p>
  </main>

  <div id="tpl-footer"></div>
  <script src="tpl-navbar.js" defer></script>
  <script src="tpl-footer.js" defer></script>

  <!-- Firebase compat (alineado con tu proyecto) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>

  <!-- TPL: INICIO BLOQUE NUEVO [Config Firebase: reutiliza la misma de reserva.html] -->
  <script>
    (function(){
      if (typeof firebase === 'undefined') return;
      if (!firebase.apps.length) {
        // MISMA CONFIG QUE EN reserva.html:
        const firebaseConfig = {
          apiKey: "AIzaSyDW73aFuz2AFS9VeWg_linHIRJYN4YMgTk",
          authDomain: "thepetslovers-c1111.firebaseapp.com",
          projectId: "thepetslovers-c1111",
          storageBucket: "thepetslovers-c1111.appspot.com",
          messagingSenderId: "415914577533",
          appId: "1:415914577533:web:0b7a056ebaa4f1de28ab14",
          measurementId: "G-FXPD69KXBG"
        };
        firebase.initializeApp(firebaseConfig);
      }
    })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->

  <!-- TPL: INICIO BLOQUE NUEVO [Auth + redirección con ?next=] -->
  <script>
    (function(){
      if (typeof firebase === 'undefined') return;
      var auth = firebase.auth();
      var $ = (id)=>document.getElementById(id);
      var email = $('email'), pass = $('pass'), msg = $('msg');
      var btnLogin = $('btnLogin'), btnSignup = $('btnSignup'), btnLogout = $('btnLogout');

      function setStatus(t){ msg.textContent = t || ''; }
      function getNext(){
        try{ return new URLSearchParams(location.search).get('next') || 'index.html'; }
        catch(_){ return 'index.html'; }
      }

      auth.onAuthStateChanged(function(user){
        if (user){
          localStorage.setItem('tpl-auth','1'); // tu web ya usa esto
          btnLogout.style.display = 'inline-block';
          setStatus('Sesión iniciada');
        } else {
          localStorage.removeItem('tpl-auth');
          btnLogout.style.display = 'none';
          setStatus('');
        }
      });

      btnLogin.addEventListener('click', async function(){
        try{
          await auth.signInWithEmailAndPassword(email.value, pass.value);
          setStatus('¡Bienvenido/a!');
          setTimeout(function(){ location.href = getNext(); }, 400);
        }catch(e){
          setStatus('No se pudo iniciar sesión. Revisa email/contraseña.');
        }
      });

      btnSignup.addEventListener('click', async function(){
        try{
          await auth.createUserWithEmailAndPassword(email.value, pass.value);
          setStatus('Cuenta creada. Has iniciado sesión.');
          setTimeout(function(){ location.href = getNext(); }, 400);
        }catch(e){
          setStatus('No se pudo crear la cuenta. ¿Ya existe ese email?');
        }
      });

      btnLogout.addEventListener('click', async function(){
        await auth.signOut();
        setStatus('Has cerrado sesión.');
      });
    })();
  </script>
  <!-- TPL: FIN BLOQUE NUEVO -->
</body>
</html>
